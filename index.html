<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ORBIT Paddle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { 
      --orbit-primary: #00f2ff;
      --orbit-secondary: #7000ff;
      --orbit-bg: #0a0b10; 
      --orbit-card: #161b22;
      --text: #ffffff;
    }
    body { font-family: 'Segoe UI', Roboto, sans-serif; padding: 20px; background: var(--orbit-bg); color: var(--text); max-width: 800px; margin: auto; }
    h1 { text-align: center; color: var(--orbit-primary); text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 10px var(--orbit-primary); }
    h3 { color: var(--orbit-secondary); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; }
    
    input, button, select { padding: 12px; margin: 8px 0; width: 100%; border-radius: 8px; border: 1px solid #30363d; box-sizing: border-box; font-size: 16px; background: #0d1117; color: white; }
    
    .grid-sets { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 10px 0; }
    .set-input { text-align: center; border-color: var(--orbit-secondary); }
    
    button { background: linear-gradient(45deg, var(--orbit-secondary), #4b00ad); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
    button:active { transform: scale(0.98); }
    .btn-win { background: linear-gradient(45deg, var(--orbit-primary), #00a2ad); color: #000; margin-top: 15px; }
    .btn-danger { background: #2d0000; color: #ff4d4d; border: 1px solid #4d0000; margin-top: 40px; font-size: 0.8em; }

    .card { background: var(--orbit-card); padding: 20px; border-radius: 16px; margin-bottom: 25px; border: 1px solid #30363d; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
    
    .ranking-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; min-width: 400px; }
    th, td { padding: 12px; border-bottom: 1px solid #30363d; text-align: center; }
    th { color: var(--orbit-primary); font-size: 0.75em; text-transform: uppercase; }
    .pct { color: #8b949e; font-size: 0.85em; font-italic: italic; }
    
    .history-item { font-size: 0.85em; border-bottom: 1px solid #30363d; padding: 12px 0; }
    .date { color: #6e7681; font-size: 0.75em; }
    .win-label { color: var(--orbit-primary); font-weight: bold; }
    
    .team-label { font-size: 0.9em; color: #8b949e; display: block; margin-top: 10px; }
  </style>
</head>
<body>

<h1>ORBIT Paddle</h1>

<div class="card">
  <h3>üöÄ Registro de Jugador</h3>
  <input id="playerName" placeholder="Nombre del astronauta..." onkeypress="if(event.key==='Enter') addPlayer()">
  <button onclick="addPlayer()">Agregar nuevo jugador</button>
</div>

<div class="card">
  <h3>‚òÑÔ∏è Registrar Partido</h3>
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
    <div>
      <span class="team-label">PAREJA ALPHA</span>
      <select id="a1"></select>
      <select id="a2"></select>
    </div>
    <div>
      <span class="team-label">PAREJA BETA</span>
      <select id="b1"></select>
      <select id="b2"></select>
    </div>
  </div>

  <div style="margin-top: 15px;">
    <span class="team-label" style="text-align: center;">RESULTADOS (Alpha - Beta)</span>
    <div class="grid-sets">
      <input type="number" id="s1a" class="set-input" placeholder="Set 1 A">
      <input type="number" id="s2a" class="set-input" placeholder="Set 2 A">
      <input type="number" id="s3a" class="set-input" placeholder="Set 3 A">
      <input type="number" id="s1b" class="set-input" placeholder="Set 1 B">
      <input type="number" id="s2b" class="set-input" placeholder="Set 2 B">
      <input type="number" id="s3b" class="set-input" placeholder="Set 3 B">
    </div>
  </div>
  
  <button class="btn-win" onclick="processMatch()">Registrar Misi√≥n</button>
</div>

<h2 style="text-align: center; color: var(--orbit-primary);">RANKING OFICIAL</h2>

<div class="card">
  <h3>üèÜ Por Puntos</h3>
  <div class="ranking-container">
    <table>
      <thead>
        <tr><th>Jugador</th><th>PJ</th><th>Pts</th></tr>
      </thead>
      <tbody id="rankPoints"></tbody>
    </table>
  </div>
</div>

<div class="card">
  <h3>üéæ Por Sets</h3>
  <div class="ranking-container">
    <table>
      <thead>
        <tr><th>Jugador</th><th>Ganados</th><th>Totales</th><th>% Eficacia</th></tr>
      </thead>
      <tbody id="rankSets"></tbody>
    </table>
  </div>
</div>

<div class="card">
  <h3>üî• Por Games</h3>
  <div class="ranking-container">
    <table>
      <thead>
        <tr><th>Jugador</th><th>Ganados</th><th>Totales</th><th>% Eficacia</th></tr>
      </thead>
      <tbody id="rankGames"></tbody>
    </table>
  </div>
</div>

<div class="card">
  <h3>üìú Bit√°cora de Partidos</h3>
  <div id="matchHistory"></div>
</div>

<button class="btn-danger" onclick="resetData()">COMPRAR AHORA</button>

<script>
let players = JSON.parse(localStorage.getItem('orbit_players') || '[]');
let history = JSON.parse(localStorage.getItem('orbit_history') || '[]');

function save() {
  localStorage.setItem('orbit_players', JSON.stringify(players));
  localStorage.setItem('orbit_history', JSON.stringify(history));
  render();
}

function addPlayer() {
  const input = document.getElementById('playerName');
  const name = input.value.trim();
  if (!name || players.find(p => p.name.toLowerCase() === name.toLowerCase())) return;
  
  players.push({ 
    name, 
    points: 0, 
    played: 0,
    setsWin: 0,
    setsTotal: 0,
    gamesWin: 0,
    gamesTotal: 0
  });
  input.value = '';
  save();
}

function processMatch() {
  const pA = [document.getElementById('a1').value, document.getElementById('a2').value];
  const pB = [document.getElementById('b1').value, document.getElementById('b2').value];
  const allNames = [...pA, ...pB];

  if (new Set(allNames).size !== 4 || allNames.includes("")) {
    alert("Selecciona 4 jugadores distintos."); return;
  }

  const scores = [
    [parseInt(document.getElementById('s1a').value || 0), parseInt(document.getElementById('s1b').value || 0)],
    [parseInt(document.getElementById('s2a').value || 0), parseInt(document.getElementById('s2b').value || 0)],
    [parseInt(document.getElementById('s3a').value || 0), parseInt(document.getElementById('s3b').value || 0)]
  ];

  let setsA = 0, setsB = 0, gamesA = 0, gamesB = 0, setsPlayed = 0;

  scores.forEach(([a, b], index) => {
    if (a === 0 && b === 0 && index > 1) return; // Set 3 no jugado
    setsPlayed++;
    gamesA += a; gamesB += b;
    if (a > b) setsA++; else if (b > a) setsB++;
  });

  const winA = setsA > setsB;
  const winners = winA ? pA : pB;
  const losers = winA ? pB : pA;

  players.forEach(p => {
    if (pA.includes(p.name)) {
      p.played++;
      p.points += winA ? 3 : 0;
      p.setsWin += setsA;
      p.setsTotal += setsPlayed;
      p.gamesWin += gamesA;
      p.gamesTotal += (gamesA + gamesB);
    }
    if (pB.includes(p.name)) {
      p.played++;
      p.points += !winA ? 3 : 0;
      p.setsWin += setsB;
      p.setsTotal += setsPlayed;
      p.gamesWin += gamesB;
      p.gamesTotal += (gamesA + gamesB);
    }
  });

  history.unshift({
    date: new Date().toLocaleString(),
    res: `${setsA}-${setsB}`,
    winners: winners.join(" & "),
    losers: losers.join(" & ")
  });

  // Limpiar inputs
  ['s1a','s2a','s3a','s1b','s2b','s3b'].forEach(id => document.getElementById(id).value = '');
  save();
}

function render() {
  const calcPct = (w, t) => t === 0 ? "0%" : ((w / t) * 100).toFixed(1) + "%";

  // Ranking Puntos
  const sortPoints = [...players].sort((a, b) => b.points - a.points);
  document.getElementById('rankPoints').innerHTML = sortPoints.map(p => 
    `<tr><td>${p.name}</td><td>${p.played}</td><td style="color:var(--orbit-primary);font-weight:bold">${p.points}</td></tr>`).join('');

  // Ranking Sets
  const sortSets = [...players].sort((a, b) => (b.setsWin/b.setsTotal || 0) - (a.setsWin/a.setsTotal || 0));
  document.getElementById('rankSets').innerHTML = sortSets.map(p => 
    `<tr><td>${p.name}</td><td>${p.setsWin}</td><td>${p.setsTotal}</td><td class="pct">${calcPct(p.setsWin, p.setsTotal)}</td></tr>`).join('');

  // Ranking Games
  const sortGames = [...players].sort((a, b) => (b.gamesWin/b.gamesTotal || 0) - (a.gamesWin/a.gamesTotal || 0));
  document.getElementById('rankGames').innerHTML = sortGames.map(p => 
    `<tr><td>${p.name}</td><td>${p.gamesWin}</td><td>${p.gamesTotal}</td><td class="pct">${calcPct(p.gamesWin, p.gamesTotal)}</td></tr>`).join('');

  // Historial y Selects
  document.getElementById('matchHistory').innerHTML = history.slice(0, 5).map(m => `
    <div class="history-item">
      <div class="date">${m.date} | Resultado: ${m.res}</div>
      <div><span class="win-label">WIN:</span> ${m.winners}</div>
      <div style="color:#666">LOSS: ${m.losers}</div>
    </div>`).join('') || 'Sin datos.';

  ['a1', 'a2', 'b1', 'b2'].forEach(id => {
    const s = document.getElementById(id);
    const val = s.value;
    s.innerHTML = '<option value="">-- Jugador --</option>' + players.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
    s.value = val;
  });
}

function resetData() {
  if (confirm("¬øReiniciar sistema?")) { players = []; history = []; save(); }
}

render();
</script>
</body>
</html>

